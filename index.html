<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'></meta>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'></meta>
    <meta name='description' content='Premium Music Player with smart recommendations'></meta>
    <meta name='keywords' content='music player, songs, audio player'></meta>
    <meta name='author' content='Your Name'></meta>
    <title>Simple Music Player</title>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css'></link>
    <style>
        :root {
            --primary: #9370DB;
            --secondary: #B384FF;
            --text: #ffffff;
            --glass: rgba(255, 255, 255, 0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text);
            padding: 10px;
            background: linear-gradient(135deg, #9370DB, #B384FF);
        }
        
        .container {
            width: 900px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: grid;
            grid-template-columns: 200px 1fr;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Sidebar */
        .sidebar {
            background: rgba(0, 0, 0, 0.1);
            padding: 15px;
            border-radius: 20px 0 0 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 18px;
        }
        
        .logo i {
            margin-right: 10px;
            font-size: 22px;
        }
        
        .menu-group {
            margin-bottom: 20px;
        }
        
        .menu-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            opacity: 0.7;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 2px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .menu-item:hover {
            background: var(--glass);
        }
        
        .menu-item.active {
            background: var(--glass);
        }
        
        .menu-item i {
            margin-right: 10px;
            width: 16px;
            text-align: center;
        }
        
        /* Main Content */
        .main {
            display: flex;
            flex-direction: column;
            padding: 15px;
            height: 100%;
        }
        
        .search-bar {
            background: var(--glass);
            border-radius: 20px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .search-bar input {
            background: transparent;
            border: none;
            outline: none;
            color: white;
            flex: 1;
            margin-left: 10px;
            font-size: 14px;
        }
        
        .search-bar input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Player */
        .player-section {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .vinyl-container {
            width: 150px;
            height: 150px;
            position: relative;
            flex-shrink: 0;
        }
        
        .vinyl {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: #000;
            background-image: 
                radial-gradient(circle at center, rgba(255, 255, 255, 0.7) 10%, transparent 11%),
                repeating-radial-gradient(rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.8) 5%, transparent 6%, transparent 9%),
                linear-gradient(to right, #000, #222, #000);
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            animation: rotate 20s linear infinite;
            animation-play-state: paused;
        }
        
        .vinyl.playing {
            animation-play-state: running;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .player-controls {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .song-info {
            margin-bottom: 15px;
        }
        
        .song-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .song-artist {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .progress-container {
            width: 100%;
            height: 4px;
            background: var(--glass);
            border-radius: 2px;
            cursor: pointer;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 100%;
            background: white;
            width: 0%;
        }
        
        .time-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 12px;
            margin-bottom: 15px;
            opacity: 0.8;
        }
        
        .control-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .control-btn {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .control-btn:hover {
            background: var(--glass);
        }
        
        .control-btn.active {
            color: var(--secondary);
        }
        
        .play-btn {
            background: white;
            color: var(--primary);
            border-radius: 50%;
            width: 45px;
            height: 45px;
        }
        
        .play-btn:hover {
            transform: scale(1.05);
            background: white;
        }
        
        .feature-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .feature-btn {
            background: var(--glass);
            border: none;
            color: white;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .feature-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .feature-btn.active {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Song List */
        .song-list-section {
            flex: 1;
            margin-top: 5px;
            display: flex;
            flex-direction: column;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 250px;
        }
        
        .list-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .list-title {
            font-size: 16px;
            font-weight: 600;
        }
        
        .song-list {
            flex: 1;
            overflow-y: auto;
            padding: 5px;
            height: 200px;
        }
        
        .song-list::-webkit-scrollbar {
            width: 5px;
        }
        
        .song-list::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .song-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
        }
        
        .song-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 2px;
            transition: all 0.2s;
        }
        
        .song-item:hover {
            background: var(--glass);
        }
        
        .song-item.active {
            background: var(--glass);
        }
        
        .song-number {
            width: 20px;
            font-size: 12px;
            text-align: center;
            opacity: 0.7;
        }
        
        .song-details {
            flex: 1;
            min-width: 0;
        }
        
        .song-name {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .song-artist-small {
            font-size: 12px;
            opacity: 0.7;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .song-duration {
            font-size: 12px;
            opacity: 0.7;
            margin-right: 5px;
        }
        
        .song-actions {
            display: flex;
            gap: 5px;
        }
        
        .song-btn {
            background: transparent;
            border: none;
            color: white;
            opacity: 0.7;
            cursor: pointer;
            transition: opacity 0.2s;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .song-btn:hover {
            opacity: 1;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            font-size: 13px;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                width: 95%;
            }
            
            .sidebar {
                border-radius: 20px 20px 0 0;
                padding: 10px;
            }
            
            .player-section {
                flex-direction: column;
                align-items: center;
            }
            
            .song-list-section {
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class='container'>
        <!-- Sidebar -->
        <div class='sidebar'>
            <div class='logo'>
                <i class='fas fa-music'></i>
                <span>Music Player</span>
            </div>
            
            <div class='menu-group'>
                <div class='menu-title'>BROWSE</div>
                <div class='menu-item active' data-category='all'>
                    <i class='fas fa-music'></i>
                    <span>All Songs</span>
                </div>
                <div class='menu-item' data-category='favorites'>
                    <i class='fas fa-heart'></i>
                    <span>Favorites</span>
                </div>
                <div class='menu-item' data-category='recent'>
                    <i class='fas fa-history'></i>
                    <span>Recently Played</span>
                </div>
            </div>
            
            <div class='menu-group'>
                <div class='menu-title'>CATEGORIES</div>
                <div class='menu-item' data-category='sad'>
                    <i class='fas fa-cloud-rain'></i>
                    <span>Sad Songs</span>
                </div>
                <div class='menu-item' data-category='party'>
                    <i class='fas fa-cocktail'></i>
                    <span>Party Songs</span>
                </div>
                <div class='menu-item' data-category='ost'>
                    <i class='fas fa-film'></i>
                    <span>OST</span>
                </div>
                <div class='menu-item' data-category='gym'>
                    <i class='fas fa-dumbbell'></i>
                    <span>Gym Songs</span>
                </div>
                <div class='menu-item' data-category='lofi'>
                    <i class='fas fa-headphones'></i>
                    <span>Lofi</span>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class='main'>
            <div class='search-bar'>
                <i class='fas fa-search'></i>
                <input type='text' id='searchInput' placeholder='Search songs, artists...'></input>
            </div>
            
            <div class='player-section'>
                <div class='vinyl-container'>
                    <div class='vinyl' id='vinyl'>
                        <div class='label' id='label'>Ishq</div>
                    </div>
                </div>
                
                <div class='player-controls'>
                    <div class='song-info'>
                        <div class='song-title' id='title'>Ishq Hai</div>
                        <div class='song-artist' id='artist'>Rahat</div>
                    </div>
                    
                    <div class='progress-container' id='progressContainer'>
                        <div class='progress-bar' id='progressBar'></div>
                    </div>
                    
                    <div class='time-info'>
                        <span id='currentTime'>0:00</span>
                        <span id='duration'>0:00</span>
                    </div>
                    
                    <div class='control-buttons'>
                        <button class='control-btn' id='shuffleBtn' title='Shuffle'>
                            <i class='fas fa-random'></i>
                        </button>
                        <button class='control-btn' id='prevBtn' title='Previous'>
                            <i class='fas fa-step-backward'></i>
                        </button>
                        <button class='control-btn play-btn' id='playBtn' title='Play/Pause'>
                            <i class='fas fa-play'></i>
                        </button>
                        <button class='control-btn' id='nextBtn' title='Next'>
                            <i class='fas fa-step-forward'></i>
                        </button>
                        <button class='control-btn' id='repeatBtn' title='Repeat'>
                            <i class='fas fa-redo'></i>
                        </button>
                    </div>
                    
                    <div class='feature-buttons'>
                        <button class='feature-btn' id='favoriteBtn' title='Add to Favorites'>
                            <i class='far fa-heart'></i>
                            <span>Favorite</span>
                        </button>
                        <button class='feature-btn' id='shareBtn' title='Share'>
                            <i class='fas fa-share-alt'></i>
                            <span>Share</span>
                        </button>
                        <button class='feature-btn' id='volumeBtn' title='Volume'>
                            <i class='fas fa-volume-up'></i>
                            <span>Volume</span>
                        </button>
                        <button class='feature-btn' id='speedBtn' title='Playback Speed'>
                            <i class='fas fa-tachometer-alt'></i>
                            <span>Speed</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class='song-list-section'>
                <div class='list-header'>
                    <div class='list-title' id='playlistTitle'>All Songs</div>
                </div>
                <div class='song-list' id='songList'>
                    <!-- Songs will be populated here -->
                </div>
            </div>
        </div>
    </div>
    
    <div class='notification' id='notification'>Notification message</div>
    
    <script>
    // Base URL for all songs
    const BASE_URL = "https://res.cloudinary.com/deiv7sq5i/video/upload/v1718461209/songs/";
    
    // Songs data with shortened links and lofi tag added to some songs
    const allSongs = [
        { name: "Tu Shayar Banaagi", description: "sad song parry sidhu", src: "music-1" },
        { name: "Kaisi Teri Khudgharzi", description: "sad song rahat fateh khan ost", src: "music-2" },
        { name: "Allah Ve", description: "sad song jassie gill", src: "music-3" },
        { name: "Baatein Ye Kabhi Na", description: "sad song arigit singh lofi", src: "music-4" },
        { name: "Bhulliye Kive'n", description: "sad song satinder sartaaj", src: "music-5" },
        { name: "Dil Diyan Gallan", description: "sad song atif aslam lofi", src: "music-6" },
        { name: "Don't Look", description: "** karan aujla gym", src: "music-7" },
        { name: "Habibi", description: "** saajz, himaanshi khurana", src: "music-8" },
        { name: "Hai Dil Ye Mera", description: "sad song arijit singh lofi", src: "music-9" },
        { name: "Ishq Hai", description: "sad song ost rahat fateh khan", src: "music-10" },
        { name: "Jaan E Jahan", description: "ost sad song rahat fateh khan", src: "music-11" },
        { name: "Jattwaad", description: "** hark cheema, gurlez akhtar gym", src: "music-12" },
        { name: "Khaie", description: "sad song ost zeb bangash", src: "music-13" },
        { name: "Khuda Aur Mohabbat", description: "sad song ost rahat fateh khan lofi", src: "music-14" },
        { name: "Like Me", description: "** amrit maan gym", src: "music-15" },
        { name: "Main Rang Sharbaton Ka", description: "sad song atif aslam lofi", src: "music-16" },
        { name: "Meherbaan", description: "sad song ost shilpa rao, ash king ishq murshid", src: "music-17" },
        { name: "Mera Mehboob", description: "sad song kumaar, stebin ben", src: "music-18" },
        { name: "Mujhe Ishq Hua", description: "sad song ost wajhi farooki raah e junoon", src: "music-19" },
        { name: "Kahani Suno", description: "sad song areeb maheer lofi", src: "music-20" },
        { name: "O Maahi", description: "sad song arijit singh", src: "music-21" },
        { name: "O Saathi", description: "sad song atif aslam lofi", src: "music-22" },
        { name: "Pachtaoge", description: "sad song arijit singh", src: "music-23" },
        { name: "Pal", description: "sad song arijit singh lofi", src: "music-24" },
        { name: "Ruposh", description: "sad song ost wajhi farooki", src: "music-25" },
        { name: "Shiddat", description: "sad song manan bhardwaj", src: "music-26" },
        { name: "Ishq Mubarak", description: "sad song arijit singh lofi", src: "music-27" },
        { name: "Tera Chehra", description: "sad song arijit singh", src: "music-28" },
        { name: "Tere Bin", description: "sad song Shani arshad lofi", src: "music-29" },
        { name: "Marke", description: "sad song jass manak", src: "music-30" },
        { name: "Veham", description: "** harf cheema, gurlez akhtar", src: "music-31" },
        { name: "Yeh Takabbur Tera", description: "sad song wajeeh uddin meer, rose mary mushtaq", src: "music-32" },
        { name: "Jindagi Awargi Hai", description: "sad song ost Jhoom lofi", src: "music-33" },
        { name: "2 Number De", description: "** guntaji dandiwal, gurlez akhtar gym", src: "music-34" },
        { name: "Angli Ghumai Jaata Ne", description: "** rahul puthi", src: "music-35" },
        { name: "Anty Bande", description: "** deepak dhillon", src: "music-36" },
        { name: "Asla", description: "** karan randhawa gym", src: "music-37" },
        { name: "Bachalo", description: "sad song akhil lofi", src: "music-38" },
        { name: "Bachke Bachke", description: "** karan aujla gym", src: "music-39" },
        { name: "Badmashi", description: "** mankirt aulakh", src: "music-40" },
        { name: "Badnam", description: "** mankirt aulakh gym", src: "music-41" },
        { name: "Bell Bottom", description: "** mankirt aulakh", src: "music-42" },
        { name: "Beruzgari", description: "sad song guri dhaliwal lofi", src: "music-43" },
        { name: "Bhabi", description: "** mankirt aulakh", src: "music-44" },
        { name: "Big Men", description: "sad song r nait, gurlez akhtar", src: "music-45" },
        { name: "Chandigarh", description: "** jass manak gym", src: "music-46" },
        { name: "Channa", description: "sad song mannat noor, feroz khan lofi", src: "music-47" },
        { name: "Chithiyaan", description: "sad song karan aujla", src: "music-48" },
        { name: "Desi Hood", description: "** saabi bhinder, cheetah gym", src: "music-49" },
        { name: "Devil", description: "** singga gym", src: "music-50" },
        { name: "Dhadkan", description: "sad song mani chopra lofi", src: "music-51" },
        { name: "Dil Todya", description: "sad song satbir aujla", src: "music-52" },
        { name: "Dismiss 141", description: "** korala maan gym", src: "music-53" },
        { name: "Distance Love", description: "sad song zehr vibe lofi", src: "music-54" },
        { name: "Ever Green", description: "** jigar", src: "music-55" },
        { name: "Filmy Scene", description: "** korala maan, gurlez akhtar", src: "music-56" },
        { name: "Gaal Ni Kadni", description: "** parmish verma gym", src: "music-57" },
        { name: "Gede", description: "** karan randhawa gym", src: "music-58" },
        { name: "Guitar Sikhda", description: "** jassie gill lofi", src: "music-59" },
        { name: "Guitar", description: "** karan randhawa", src: "music-60" }
    ];

    // DOM Elements
    const audio = new Audio();
    const vinyl = document.getElementById('vinyl');
    const label = document.getElementById('label');
    const title = document.getElementById('title');
    const artist = document.getElementById('artist');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const currentTime = document.getElementById('currentTime');
    const duration = document.getElementById('duration');
    const playBtn = document.getElementById('playBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const repeatBtn = document.getElementById('repeatBtn');
    const favoriteBtn = document.getElementById('favoriteBtn');
    const shareBtn = document.getElementById('shareBtn');
    const volumeBtn = document.getElementById('volumeBtn');
    const speedBtn = document.getElementById('speedBtn');
    const songList = document.getElementById('songList');
    const playlistTitle = document.getElementById('playlistTitle');
    const searchInput = document.getElementById('searchInput');
    const notification = document.getElementById('notification');
    const menuItems = document.querySelectorAll('.menu-item');

    // State
    let currentIndex = 9; // Start with Ishq Hai
    let isPlaying = false;
    let isShuffle = false;
    let repeatMode = 'off'; // off, all, one
    let currentCategory = 'all';
    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    let recentlyPlayed = JSON.parse(localStorage.getItem('recentlyPlayed') || '[]');
    let volume = 1;
    let speed = 1;

    // Helper Functions
    function getFullUrl(src) {
        return `${BASE_URL}${src}.mp3`;
    }
    
    function notify(message) {
        notification.textContent = message;
        notification.classList.add('show');
        setTimeout(() => notification.classList.remove('show'), 2000);
    }

    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
        return `${mins}:${secs}`;
    }

    function getArtist(description) {
        if (!description) return '';
        
        const words = description.toLowerCase().split(' ');
        for (let i = 0; i < words.length; i++) {
            if (['sad', 'song', 'ost', '**', 'gym', 'lofi'].includes(words[i])) continue;
            
            if (words[i].length > 2) {
                return words[i].charAt(0).toUpperCase() + words[i].slice(1);
            }
        }
        
        return '';
    }

    // Get next song in the current category
    function getNextSongInCategory(index, direction = 1) {
        // If all songs, or shuffle, just use normal behavior
        if (currentCategory === 'all' || isShuffle) {
            if (isShuffle) {
                // Get a random song
                do {
                    index = Math.floor(Math.random() * allSongs.length);
                } while (index === currentIndex && allSongs.length > 1);
                return index;
            } else {
                // Get next/prev song in order
                return (index + direction + allSongs.length) % allSongs.length;
            }
        }
        
        // For specific categories, find the next/prev song in that category
        let categoryFilter;
        switch(currentCategory) {
            case 'favorites':
                categoryFilter = song => favorites.includes(song.src);
                break;
            case 'recent':
                return null; // Special case handled separately
            case 'sad':
                categoryFilter = song => song.description.toLowerCase().includes('sad song');
                break;
            case 'party':
                categoryFilter = song => song.description.toLowerCase().includes('**');
                break;
            case 'ost':
                categoryFilter = song => song.description.toLowerCase().includes('ost');
                break;
            case 'gym':
                categoryFilter = song => song.description.toLowerCase().includes('gym');
                break;
            case 'lofi':
                categoryFilter = song => song.description.toLowerCase().includes('lofi');
                break;
            default:
                return (index + direction + allSongs.length) % allSongs.length;
        }
        
        // Get all songs in this category
        const categorySongs = allSongs.filter(categoryFilter);
        if (categorySongs.length === 0) return null;
        
        // Find the current song's index in this category
        const currentSong = allSongs[currentIndex];
        const categoryIndex = categorySongs.findIndex(song => song.src === currentSong.src);
        
        // If not found in this category, return the first song
        if (categoryIndex === -1) return allSongs.indexOf(categorySongs[0]);
        
        // Get the next/prev song in this category
        const nextCategoryIndex = (categoryIndex + direction + categorySongs.length) % categorySongs.length;
        const nextSong = categorySongs[nextCategoryIndex];
        
        // Return the global index
        return allSongs.indexOf(nextSong);
    }

    // Player Functions
    function loadSong(index) {
        if (index < 0 || index >= allSongs.length) return;
        
        currentIndex = index;
        const song = allSongs[currentIndex];
        
        title.textContent = song.name;
        label.textContent = song.name.split(' ')[0]; // First word only for label
        artist.textContent = getArtist(song.description);
        
        audio.src = getFullUrl(song.src);
        audio.playbackRate = speed;
        audio.volume = volume;
        
        // Add to recently played
        const foundIndex = recentlyPlayed.findIndex(src => src === song.src);
        if (foundIndex !== -1) {
            recentlyPlayed.splice(foundIndex, 1);
        }
        recentlyPlayed.unshift(song.src);
        if (recentlyPlayed.length > 10) recentlyPlayed.pop();
        localStorage.setItem('recentlyPlayed', JSON.stringify(recentlyPlayed));
        
        // Update favorite button
        updateFavoriteButton();
        
        // Reset progress bar
        progressBar.style.width = '0%';
        currentTime.textContent = '0:00';
        duration.textContent = '0:00';
        
        // Update active song in list
        updateActiveSong();
    }

    function playSong() {
        isPlaying = true;
        vinyl.classList.add('playing');
        playBtn.innerHTML = '<i class="fas fa-pause"></i>';
        
        audio.play().catch(() => {
            notify("Error playing song");
        });
    }

    function pauseSong() {
        isPlaying = false;
        vinyl.classList.remove('playing');
        playBtn.innerHTML = '<i class="fas fa-play"></i>';
        
        audio.pause();
    }

    function nextSong() {
        // If in a specific category, find next song in that category
        const nextIndex = getNextSongInCategory(currentIndex, 1);
        
        // Special case for recently played
        if (currentCategory === 'recent') {
            const recentIndex = recentlyPlayed.indexOf(allSongs[currentIndex].src);
            if (recentIndex === -1 || recentIndex === recentlyPlayed.length - 1) {
                // Current song not in recent list or last in list
                if (recentlyPlayed.length > 0) {
                    const firstRecentSong = allSongs.find(song => song.src === recentlyPlayed[0]);
                    if (firstRecentSong) loadSong(allSongs.indexOf(firstRecentSong));
                }
            } else {
                // Go to next recent song
                const nextRecentSrc = recentlyPlayed[recentIndex + 1];
                const nextRecentSong = allSongs.find(song => song.src === nextRecentSrc);
                if (nextRecentSong) loadSong(allSongs.indexOf(nextRecentSong));
            }
        } else if (nextIndex !== null) {
            loadSong(nextIndex);
        }
        
        if (isPlaying) playSong();
    }

    function prevSong() {
        if (audio.currentTime > 3) {
            audio.currentTime = 0;
            return;
        }
        
        // If in a specific category, find prev song in that category
        const prevIndex = getNextSongInCategory(currentIndex, -1);
        
        // Special case for recently played
        if (currentCategory === 'recent') {
            const recentIndex = recentlyPlayed.indexOf(allSongs[currentIndex].src);
            if (recentIndex <= 0) {
                // Current song not in recent list or first in list
                if (recentlyPlayed.length > 0) {
                    const lastRecentSong = allSongs.find(song => song.src === recentlyPlayed[recentlyPlayed.length - 1]);
                    if (lastRecentSong) loadSong(allSongs.indexOf(lastRecentSong));
                }
            } else {
                // Go to previous recent song
                const prevRecentSrc = recentlyPlayed[recentIndex - 1];
                const prevRecentSong = allSongs.find(song => song.src === prevRecentSrc);
                if (prevRecentSong) loadSong(allSongs.indexOf(prevRecentSong));
            }
        } else if (prevIndex !== null) {
            loadSong(prevIndex);
        }
        
        if (isPlaying) playSong();
    }

    function toggleFavorite() {
        const song = allSongs[currentIndex];
        const isFavorite = favorites.includes(song.src);
        
        if (isFavorite) {
            favorites = favorites.filter(src => src !== song.src);
            favoriteBtn.innerHTML = '<i class="far fa-heart"></i><span>Favorite</span>';
            favoriteBtn.classList.remove('active');
            notify("Removed from favorites");
        } else {
            favorites.push(song.src);
            favoriteBtn.innerHTML = '<i class="fas fa-heart"></i><span>Favorite</span>';
            favoriteBtn.classList.add('active');
            notify("Added to favorites");
        }
        
        localStorage.setItem('favorites', JSON.stringify(favorites));
        
        if (currentCategory === 'favorites') {
            loadCategory('favorites');
        }
    }

    function updateFavoriteButton() {
        const song = allSongs[currentIndex];
        const isFavorite = favorites.includes(song.src);
        
        if (isFavorite) {
            favoriteBtn.innerHTML = '<i class="fas fa-heart"></i><span>Favorite</span>';
            favoriteBtn.classList.add('active');
        } else {
            favoriteBtn.innerHTML = '<i class="far fa-heart"></i><span>Favorite</span>';
            favoriteBtn.classList.remove('active');
        }
    }

    function shareSong() {
        const song = allSongs[currentIndex];
        
        navigator.clipboard.writeText(getFullUrl(song.src))
            .then(() => notify("Song link copied"))
            .catch(() => notify("Failed to copy link"));
    }

    function adjustVolume() {
        volume = (volume + 0.2) % 1.2;
        if (volume > 1) volume = 0;
        
        audio.volume = volume;
        
        let volumeIcon;
        if (volume === 0) {
            volumeIcon = 'volume-mute';
        } else if (volume <= 0.4) {
            volumeIcon = 'volume-down';
        } else {
            volumeIcon = 'volume-up';
        }
        
        volumeBtn.innerHTML = `<i class="fas fa-${volumeIcon}"></i><span>Volume: ${Math.round(volume * 100)}%</span>`;
        notify(`Volume: ${Math.round(volume * 100)}%`);
    }

    function adjustSpeed() {
        const speeds = [0.5, 0.75, 1, 1.25, 1.5, 2];
        const currentIndex = speeds.indexOf(speed);
        const nextIndex = (currentIndex + 1) % speeds.length;
        speed = speeds[nextIndex];
        
        audio.playbackRate = speed;
        speedBtn.innerHTML = `<i class="fas fa-tachometer-alt"></i><span>Speed: ${speed}x</span>`;
        notify(`Speed: ${speed}x`);
    }

    function updateProgress() {
        const { currentTime: time, duration: total } = audio;
        
        if (total) {
            const percent = (time / total) * 100;
            progressBar.style.width = `${percent}%`;
            
            currentTime.textContent = formatTime(time);
            duration.textContent = formatTime(total);
        }
    }

    function setProgress(e) {
        const width = progressContainer.clientWidth;
        const clickX = e.offsetX;
        const duration = audio.duration;
        
        if (duration) {
            audio.currentTime = (clickX / width) * duration;
        }
    }

    function toggleShuffle() {
        isShuffle = !isShuffle;
        shuffleBtn.classList.toggle('active');
        notify(isShuffle ? 'Shuffle: On' : 'Shuffle: Off');
    }

    function toggleRepeat() {
        if (repeatMode === 'off') {
            repeatMode = 'all';
            repeatBtn.classList.add('active');
            notify('Repeat: All');
        } else if (repeatMode === 'all') {
            repeatMode = 'one';
            repeatBtn.innerHTML = '<i class="fas fa-redo-alt"></i>';
            notify('Repeat: One');
        } else {
            repeatMode = 'off';
            repeatBtn.innerHTML = '<i class="fas fa-redo"></i>';
            repeatBtn.classList.remove('active');
            notify('Repeat: Off');
        }
    }

    function loadCategory(category) {
        currentCategory = category;
        
        menuItems.forEach(item => {
            item.classList.remove('active');
            if (item.dataset.category === category) {
                item.classList.add('active');
            }
        });
        
        switch(category) {
            case 'all': playlistTitle.textContent = 'All Songs'; break;
            case 'favorites': playlistTitle.textContent = 'Favorites'; break;
            case 'recent': playlistTitle.textContent = 'Recently Played'; break;
            case 'sad': playlistTitle.textContent = 'Sad Songs'; break;
            case 'party': playlistTitle.textContent = 'Party Songs'; break;
            case 'ost': playlistTitle.textContent = 'OST'; break;
            case 'gym': playlistTitle.textContent = 'Gym Songs'; break;
            case 'lofi': playlistTitle.textContent = 'Lofi'; break;
            default: playlistTitle.textContent = 'All Songs';
        }
        
        let songs;
        switch(category) {
            case 'all':
                songs = [...allSongs];
                break;
            case 'favorites':
                songs = allSongs.filter(song => favorites.includes(song.src));
                break;
            case 'recent':
                songs = recentlyPlayed.map(src => 
                    allSongs.find(song => song.src === src)
                ).filter(Boolean);
                break;
            case 'sad':
                songs = allSongs.filter(song => 
                    song.description.toLowerCase().includes('sad song')
                );
                break;
            case 'party':
                songs = allSongs.filter(song => 
                    song.description.toLowerCase().includes('**')
                );
                break;
            case 'ost':
                songs = allSongs.filter(song => 
                    song.description.toLowerCase().includes('ost')
                );
                break;
            case 'gym':
                songs = allSongs.filter(song => 
                    song.description.toLowerCase().includes('gym')
                );
                break;
            case 'lofi':
                songs = allSongs.filter(song => 
                    song.description.toLowerCase().includes('lofi')
                );
                break;
            default:
                songs = [...allSongs];
        }
        
        renderSongList(songs);
    }

    function renderSongList(songs) {
        songList.innerHTML = '';
        
        if (songs.length === 0) {
            songList.innerHTML = '<div style="text-align: center; padding: 10px; opacity: 0.7;">No songs found</div>';
            return;
        }
        
        songs.forEach((song, index) => {
            const globalIndex = allSongs.findIndex(s => s.src === song.src);
            const isActive = globalIndex === currentIndex;
            const isFav = favorites.includes(song.src);
            
            const songItem = document.createElement('div');
            songItem.className = `song-item${isActive ? ' active' : ''}`;
            songItem.innerHTML = `
                <div class='song-number'>${index + 1}</div>
                <div class='song-details'>
                    <div class='song-name'>${song.name}</div>
                    <div class='song-artist-small'>${getArtist(song.description)}</div>
                </div>
                <div class='song-actions'>
                    <button class='song-btn favorite-btn' title='Favorite'>
                        <i class='${isFav ? 'fas' : 'far'} fa-heart'></i>
                    </button>
                    <button class='song-btn share-btn' title='Share'>
                        <i class='fas fa-share-alt'></i>
                    </button>
                    <button class='song-btn play-btn' title='Play'>
                        <i class='fas fa-play'></i>
                    </button>
                </div>
            `;
            
            // Play song on click
            songItem.addEventListener('click', function() {
                loadSong(globalIndex);
                playSong();
            });
            
            // Song controls
            const playBtn = songItem.querySelector('.play-btn');
            playBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                loadSong(globalIndex);
                playSong();
            });
            
            // Favorite button
            const favBtn = songItem.querySelector('.favorite-btn');
            favBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                
                if (favorites.includes(song.src)) {
                    favorites = favorites.filter(src => src !== song.src);
                    favBtn.innerHTML = '<i class="far fa-heart"></i>';
                    notify("Removed from favorites");
                } else {
                    favorites.push(song.src);
                    favBtn.innerHTML = '<i class="fas fa-heart"></i>';
                    notify("Added to favorites");
                }
                
                localStorage.setItem('favorites', JSON.stringify(favorites));
                
                if (globalIndex === currentIndex) {
                    updateFavoriteButton();
                }
                
                if (currentCategory === 'favorites') {
                    loadCategory('favorites');
                }
            });
            
            // Share button
            const shareBtn = songItem.querySelector('.share-btn');
            shareBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                
                navigator.clipboard.writeText(getFullUrl(song.src))
                    .then(() => notify("Link copied"))
                    .catch(() => notify("Failed to copy"));
            });
            
            songList.appendChild(songItem);
        });
    }

    function updateActiveSong() {
        document.querySelectorAll('.song-item').forEach(item => {
            item.classList.remove('active');
        });
        
        const items = Array.from(document.querySelectorAll('.song-item'));
        for (let i = 0; i < items.length; i++) {
            const songName = items[i].querySelector('.song-name').textContent;
            if (songName === allSongs[currentIndex].name) {
                items[i].classList.add('active');
                items[i].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                break;
            }
        }
    }

    function search() {
        const query = searchInput.value.toLowerCase();
        
        if (!query) {
            loadCategory(currentCategory);
            return;
        }
        
        const results = allSongs.filter(song => 
            song.name.toLowerCase().includes(query) || 
            song.description.toLowerCase().includes(query)
        );
        
        playlistTitle.textContent = `Search: "${query}"`;
        renderSongList(results);
    }

    // Event Listeners
    playBtn.addEventListener('click', function() {
        if (isPlaying) pauseSong();
        else playSong();
    });
    prevBtn.addEventListener('click', prevSong);
    nextBtn.addEventListener('click', nextSong);
    shuffleBtn.addEventListener('click', toggleShuffle);
    repeatBtn.addEventListener('click', toggleRepeat);
    favoriteBtn.addEventListener('click', toggleFavorite);
    shareBtn.addEventListener('click', shareSong);
    volumeBtn.addEventListener('click', adjustVolume);
    speedBtn.addEventListener('click', adjustSpeed);
    progressContainer.addEventListener('click', setProgress);
    
    audio.addEventListener('timeupdate', updateProgress);
    audio.addEventListener('ended', function() {
        if (repeatMode === 'one') {
            audio.currentTime = 0;
            audio.play();
        } else if (repeatMode === 'all' || currentIndex < allSongs.length - 1) {
            nextSong();
        } else {
            pauseSong();
            audio.currentTime = 0;
        }
    });
    
    searchInput.addEventListener('input', search);
    
    menuItems.forEach(item => {
        item.addEventListener('click', function() {
            loadCategory(item.dataset.category);
        });
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (document.activeElement.tagName === 'INPUT') return;
        
        switch (e.code) {
            case 'Space':
                e.preventDefault();
                if (isPlaying) pauseSong();
                else playSong();
                break;
            case 'ArrowLeft':
                e.preventDefault();
                audio.currentTime -= 10;
                break;
            case 'ArrowRight':
                e.preventDefault();
                audio.currentTime += 10;
                break;
            case 'ArrowUp':
                e.preventDefault();
                volume = Math.min(1, volume + 0.1);
                audio.volume = volume;
                notify(`Volume: ${Math.round(volume * 100)}%`);
                break;
            case 'ArrowDown':
                e.preventDefault();
                volume = Math.max(0, volume - 0.1);
                audio.volume = volume;
                notify(`Volume: ${Math.round(volume * 100)}%`);
                break;
        }
    });
    
    // Initialize
    loadSong(currentIndex);
    loadCategory('all');
    </script>
</body>
</html>
